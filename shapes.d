

import matrix;

import std.algorithm : map;
import std.array : array;



struct Vertex
{
    Vec4 loc;
    float color_r;
    float color_b;
    float color_g;
}


Vertex[4][] tesseract(bool centered = false)(Vec4 pos = Vec4(0, 0, 0, 0), Vec4 dim = Vec4(1, 1, 1, 1),
                                             Mat4 transform = Mat4.init)
{
    Vertex[4][] v =
        [
            // x-y-z cubes
            [
                Vertex(Vec4(0.0, 0.0, 0.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 0.0, 0.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 1.0, 0.0), 1.0, 1.0, 0.0),
                ],
            [
                Vertex(Vec4(1.0, 0.0, 0.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 0.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 0.0), 1.0, 0.0, 0.0),
                ],
            [
                Vertex(Vec4(0.0, 1.0, 1.0, 0.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 0.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 0.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 1.0, 0.0), 0.0, 1.0, 0.0),
                ],
            [
                Vertex(Vec4(1.0, 0.0, 1.0, 0.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(1.0, 0.0, 0.0, 0.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 0.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(0.0, 0.0, 1.0, 0.0), 0.0, 0.0, 1.0),
                ],
            [
                Vertex(Vec4(0.0, 0.0, 1.0, 0.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 0.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(1.0, 0.0, 0.0, 0.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 0.0), 0.0, 1.0, 1.0),
                ],
            [
                Vertex(Vec4(0.0, 0.0, 0.0, 1.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 0.0, 0.0, 1.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 1.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 1.0, 1.0), 1.0, 1.0, 0.0),
                ],
            [
                Vertex(Vec4(1.0, 0.0, 0.0, 1.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 1.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 0.0, 1.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 1.0), 1.0, 0.0, 0.0),
                ],
            [
                Vertex(Vec4(0.0, 1.0, 1.0, 1.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 1.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 1.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 1.0, 1.0), 0.0, 1.0, 0.0),
                ],
            [
                Vertex(Vec4(1.0, 0.0, 1.0, 1.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(1.0, 0.0, 0.0, 1.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 1.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(0.0, 0.0, 1.0, 1.0), 0.0, 0.0, 1.0),
                ],
            [
                Vertex(Vec4(0.0, 0.0, 1.0, 1.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 1.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(1.0, 0.0, 0.0, 1.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 1.0), 0.0, 1.0, 1.0),
                ],
            // y-z-w cubes
            [
                Vertex(Vec4(0.0, 0.0, 0.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 1.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 0.0, 1.0), 1.0, 1.0, 0.0),
                ],
            [
                Vertex(Vec4(0.0, 1.0, 0.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 1.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 1.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 1.0, 1.0), 1.0, 0.0, 0.0),
                ],
            [
                Vertex(Vec4(0.0, 0.0, 1.0, 1.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 1.0, 0.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 1.0, 1.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 0.0, 1.0), 0.0, 1.0, 0.0),
                ],
            [
                Vertex(Vec4(0.0, 1.0, 0.0, 1.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 0.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(0.0, 1.0, 1.0, 1.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(0.0, 0.0, 0.0, 1.0), 0.0, 0.0, 1.0),
                ],
            [
                Vertex(Vec4(0.0, 0.0, 0.0, 1.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(0.0, 0.0, 1.0, 0.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 0.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(0.0, 1.0, 1.0, 1.0), 0.0, 1.0, 1.0),
                ],
            [
                Vertex(Vec4(1.0, 0.0, 0.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 0.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 0.0, 1.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 0.0, 0.0, 1.0), 1.0, 1.0, 0.0),
                ],
            [
                Vertex(Vec4(1.0, 1.0, 0.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0, 0.0, 1.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 1.0), 1.0, 0.0, 0.0),
                ],
            [
                Vertex(Vec4(1.0, 0.0, 1.0, 1.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 0.0, 1.0, 0.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 1.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 0.0, 0.0, 1.0), 0.0, 1.0, 0.0),
                ],
            [
                Vertex(Vec4(1.0, 1.0, 0.0, 1.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(1.0, 1.0, 0.0, 0.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 1.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(1.0, 0.0, 0.0, 1.0), 0.0, 0.0, 1.0),
                ],
            [
                Vertex(Vec4(1.0, 0.0, 0.0, 1.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(1.0, 0.0, 1.0, 0.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(1.0, 1.0, 0.0, 0.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 1.0), 0.0, 1.0, 1.0),
                ],
            // x-z-w cubes
            [
                Vertex(Vec4(0.0, 0.0, 0.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 0.0, 0.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 1.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 0.0, 1.0), 1.0, 1.0, 0.0),
                ],
            [
                Vertex(Vec4(1.0, 0.0, 0.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 1.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0, 0.0, 1.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0, 0.0, 1.0, 1.0), 1.0, 0.0, 0.0),
                ],
            [
                Vertex(Vec4(0.0, 0.0, 1.0, 1.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 1.0, 0.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 0.0, 1.0, 1.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 0.0, 1.0), 0.0, 1.0, 0.0),
                ],
            [
                Vertex(Vec4(1.0, 0.0, 0.0, 1.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(1.0, 0.0, 0.0, 0.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(1.0, 0.0, 1.0, 1.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(0.0, 0.0, 0.0, 1.0), 0.0, 0.0, 1.0),
                ],
            [
                Vertex(Vec4(0.0, 0.0, 0.0, 1.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(0.0, 0.0, 1.0, 0.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(1.0, 0.0, 0.0, 0.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(1.0, 0.0, 1.0, 1.0), 0.0, 1.0, 1.0),
                ],
            [
                Vertex(Vec4(0.0, 1.0, 0.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 0.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 1.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 1.0), 1.0, 1.0, 0.0),
                ],
            [
                Vertex(Vec4(1.0, 1.0, 0.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 1.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 1.0), 1.0, 0.0, 0.0),
                ],
            [
                Vertex(Vec4(0.0, 1.0, 1.0, 1.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 1.0, 0.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 1.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 1.0), 0.0, 1.0, 0.0),
                ],
            [
                Vertex(Vec4(1.0, 1.0, 0.0, 1.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(1.0, 1.0, 0.0, 0.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 1.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 1.0), 0.0, 0.0, 1.0),
                ],
            [
                Vertex(Vec4(0.0, 1.0, 0.0, 1.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(0.0, 1.0, 1.0, 0.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(1.0, 1.0, 0.0, 0.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 1.0), 0.0, 1.0, 1.0),
                ],
            // x-y-w cubes
            [
                Vertex(Vec4(0.0, 0.0, 0.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 0.0, 0.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 0.0, 1.0), 1.0, 1.0, 0.0),
                ],
            [
                Vertex(Vec4(1.0, 0.0, 0.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 0.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 0.0, 1.0), 1.0, 0.0, 0.0),
                ],
            [
                Vertex(Vec4(0.0, 1.0, 0.0, 1.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 0.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 0.0, 1.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 0.0, 1.0), 0.0, 1.0, 0.0),
                ],
            [
                Vertex(Vec4(1.0, 0.0, 0.0, 1.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(1.0, 0.0, 0.0, 0.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(1.0, 1.0, 0.0, 1.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(0.0, 0.0, 0.0, 1.0), 0.0, 0.0, 1.0),
                ],
            [
                Vertex(Vec4(0.0, 0.0, 0.0, 1.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(0.0, 1.0, 0.0, 0.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(1.0, 0.0, 0.0, 0.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(1.0, 1.0, 0.0, 1.0), 0.0, 1.0, 1.0),
                ],
            [
                Vertex(Vec4(0.0, 0.0, 1.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 0.0, 1.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 1.0, 0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 1.0, 1.0), 1.0, 1.0, 0.0),
                ],
            [
                Vertex(Vec4(1.0, 0.0, 1.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 1.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 1.0), 1.0, 0.0, 0.0),
                ],
            [
                Vertex(Vec4(0.0, 1.0, 1.0, 1.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 1.0, 1.0, 0.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 1.0), 0.0, 1.0, 0.0),
                Vertex(Vec4(0.0, 0.0, 1.0, 1.0), 0.0, 1.0, 0.0),
                ],
            [
                Vertex(Vec4(1.0, 0.0, 1.0, 1.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(1.0, 0.0, 1.0, 0.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 1.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(0.0, 0.0, 1.0, 1.0), 0.0, 0.0, 1.0),
                ],
            [
                Vertex(Vec4(0.0, 0.0, 1.0, 1.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(0.0, 1.0, 1.0, 0.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(1.0, 0.0, 1.0, 0.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(1.0, 1.0, 1.0, 1.0), 0.0, 1.0, 1.0),
                ],
            ];

    foreach (int i, ref t; v)
    {
        foreach (ref vert; t)
        {
            static if (centered)
            {
                vert.loc = transform * (ewise_p(vert.loc, dim) - 0.5 * dim) + pos;
            }
            else
            {
                vert.loc = transform * ewise_p(vert.loc, dim) + pos;
            }
            vert.color_r /= (i % 7 + i / 5 + 1) / 2.0;
            vert.color_b /= (i % 5 + i / 3 + 1) / 5.0;
            vert.color_g /= (i % 3 + i / 7 + 1) / 3.0;
            //writeln(vert);
        }
    }

    return v;
}


Vertex[4][] fivecell(Vec4 pos = Vec4(0, 0, 0, 0), Mat4 transform = Mat4.init)
{
    Vertex[4][] v =
        [
            [
                Vertex(Vec4(1.0 / sqrt(10.0),        1.0 / sqrt(6.0),  1.0 / sqrt(3.0), -1.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(1.0 / sqrt(10.0),        1.0 / sqrt(6.0), -2.0 / sqrt(3.0),  0.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(1.0 / sqrt(10.0),       -3.0 / sqrt(2.0),  0.0,              0.0), 0.0, 1.0, 1.0),
                Vertex(Vec4(-2.0 / sqrt(2.0 / 5.0),  0.0,              0.0,              0.0), 0.0, 1.0, 1.0),
                ],
            [
                Vertex(Vec4(1.0 / sqrt(10.0),        1.0 / sqrt(6.0),  1.0 / sqrt(3.0),  1.0), 1.0, 0.0, 1.0),
                Vertex(Vec4(1.0 / sqrt(10.0),        1.0 / sqrt(6.0), -2.0 / sqrt(3.0),  0.0), 1.0, 0.0, 1.0),
                Vertex(Vec4(1.0 / sqrt(10.0),       -3.0 / sqrt(2.0),  0.0,              0.0), 1.0, 0.0, 1.0),
                Vertex(Vec4(-2.0 / sqrt(2.0 / 5.0),  0.0,              0.0,              0.0), 1.0, 0.0, 1.0),
                ],
            [
                Vertex(Vec4(1.0 / sqrt(10.0),        1.0 / sqrt(6.0),  1.0 / sqrt(3.0),  1.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(1.0 / sqrt(10.0),        1.0 / sqrt(6.0),  1.0 / sqrt(3.0), -1.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(1.0 / sqrt(10.0),       -3.0 / sqrt(2.0),  0.0,              0.0), 1.0, 1.0, 0.0),
                Vertex(Vec4(-2.0 / sqrt(2.0 / 5.0),  0.0,              0.0,              0.0), 1.0, 1.0, 0.0),
                ],
            [
                Vertex(Vec4(1.0 / sqrt(10.0),        1.0 / sqrt(6.0),  1.0 / sqrt(3.0),  1.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(1.0 / sqrt(10.0),        1.0 / sqrt(6.0),  1.0 / sqrt(3.0), -1.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(1.0 / sqrt(10.0),        1.0 / sqrt(6.0), -2.0 / sqrt(3.0),  0.0), 0.0, 0.0, 1.0),
                Vertex(Vec4(-2.0 / sqrt(2.0 / 5.0),  0.0,              0.0,              0.0), 0.0, 0.0, 1.0),
                ],
            [
                Vertex(Vec4(1.0 / sqrt(10.0),        1.0 / sqrt(6.0),  1.0 / sqrt(3.0),  1.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0 / sqrt(10.0),        1.0 / sqrt(6.0),  1.0 / sqrt(3.0), -1.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0 / sqrt(10.0),        1.0 / sqrt(6.0), -2.0 / sqrt(3.0),  0.0), 1.0, 0.0, 0.0),
                Vertex(Vec4(1.0 / sqrt(10.0),       -3.0 / sqrt(2.0),  0.0,              0.0), 1.0, 0.0, 0.0),
                ],
            ];

    foreach (int i, ref t; v)
    {
        foreach (ref vert; t)
        {
            vert.loc = transform * vert.loc + pos;
            vert.color_r /= 2.0;
            vert.color_b /= 2.0;
            vert.color_g /= 2.0;
            //writeln(vert);
        }
    }

    return v;
}
